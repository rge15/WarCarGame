ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 ;===================================================================================================================================================
                              2 ; CPCTelera functions
                              3 ;===================================================================================================================================================
                              4 .globl cpct_scanKeyboard_f_asm
                              5 .globl cpct_isKeyPressed_asm
                              6 
                              7 ;===================================================================================================================================================
                              8 ; Public functions
                              9 ;===================================================================================================================================================
                             10 .globl _man_entityForAllMatching
                             11 .globl _man_entityDestroy
                             12 .globl _man_setEntity4Destroy
                             13 .globl _m_game_playerShot
                             14 
                             15 ;===================================================================================================================================================
                             16 ; Public data
                             17 ;===================================================================================================================================================
                             18 .globl _m_functionMemory
                             19 .globl _m_signatureMatch
                             20 
                             21 ;===================================================================================================================================================
                             22 ; FUNCION _sys_physics_update
                             23 ; Llama a la inversi√≥n de control para updatear las fisicas de cada entidad que coincida con e_type_movable
                             24 ; NO llega ningun dato
                             25 ;===================================================================================================================================================
   0000                      26 _sys_physics_update::
   0000 21 44 00      [10]   27     ld hl, #_sys_physics_updateOneEntity
   0003 22 00 00      [16]   28     ld (_m_functionMemory), hl
   0006 21 00 00      [10]   29     ld hl , #_m_signatureMatch 
   0009 36 02         [10]   30     ld (hl), #0x02  ; e_type_movable
   000B CD 00 00      [17]   31     call _man_entityForAllMatching
   000E C9            [10]   32     ret
                             33 
                             34 ;===================================================================================================================================================
                             35 ; FUNCION _sys_physics_checkKeyboard
                             36 ; Cambia el valor de la velocidad en x si se pulsa la tecla : O o P
                             37 ; Y manda la orden de disparar si pulsa Espacio
                             38 ; HL : LA entidad a updatear
                             39 ;===================================================================================================================================================
   000F                      40 _sys_physics_checkKeyboard::
   000F 23            [ 6]   41     inc hl
   0010 23            [ 6]   42     inc hl
   0011 23            [ 6]   43     inc hl
   0012 23            [ 6]   44     inc hl
   0013 23            [ 6]   45     inc hl
   0014 23            [ 6]   46     inc hl
   0015 E5            [11]   47     push hl
                             48 
   0016 CD 00 00      [17]   49     call cpct_scanKeyboard_f_asm
                             50     
   0019 21 04 04      [10]   51     ld hl, #0x0404  ;;Key O
   001C CD 00 00      [17]   52     call cpct_isKeyPressed_asm
   001F 20 0E         [12]   53     jr NZ, leftPressed
                             54 
   0021 21 03 08      [10]   55     ld hl, #0x0803 ;;Key P
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



   0024 CD 00 00      [17]   56     call cpct_isKeyPressed_asm
   0027 20 0C         [12]   57     jr NZ, rightPressed
                             58 
   0029 E1            [10]   59     pop hl
   002A 36 00         [10]   60     ld (hl), #0x00
                             61 
   002C C3 38 00      [10]   62     jp stopCheckMovement
   002F                      63     leftPressed:
   002F E1            [10]   64         pop hl
   0030 36 FF         [10]   65         ld (hl), #0xFF
   0032 C3 38 00      [10]   66         jp stopCheckMovement
   0035                      67     rightPressed:
   0035 E1            [10]   68         pop hl
   0036 36 01         [10]   69         ld (hl), #0x01
                             70 
   0038                      71     stopCheckMovement:
                             72 
   0038 21 05 80      [10]   73     ld hl, #0x8005 ;;Key SpaceBar
   003B CD 00 00      [17]   74     call cpct_isKeyPressed_asm
   003E 28 03         [12]   75     jr Z, dontShoot
   0040 CD 00 00      [17]   76     call _m_game_playerShot
                             77 
   0043                      78     dontShoot:
   0043 C9            [10]   79     ret
                             80 
                             81 
                             82 ;===================================================================================================================================================
                             83 ; FUNCION _sys_physics_updateOneEntity
                             84 ; Updatea las posiciones de las entidades en funcion de 
                             85 ; los valores de sus velocidades
                             86 ; HL : Entidad a updatear
                             87 ;===================================================================================================================================================
   0044                      88 _sys_physics_updateOneEntity::    
   0044 E5            [11]   89     push hl
   0045 23            [ 6]   90     inc hl
   0046 7E            [ 7]   91     ld a,(hl) 
   0047 2B            [ 6]   92     dec hl
   0048 E6 04         [ 7]   93     and #0x04
   004A 44            [ 4]   94     ld b,h
   004B 4D            [ 4]   95     ld c,l
   004C 28 03         [12]   96     jr Z,noInput
   004E CD 0F 00      [17]   97     call _sys_physics_checkKeyboard
   0051                      98     noInput:
   0051 E1            [10]   99     pop hl
                            100 
   0052 23            [ 6]  101     inc hl
   0053 23            [ 6]  102     inc hl
   0054 46            [ 7]  103     ld  b,(hl) ; posX
   0055 23            [ 6]  104     inc hl
   0056 56            [ 7]  105     ld  d,(hl) ; posY 
                            106 
   0057 23            [ 6]  107     inc hl
   0058 23            [ 6]  108     inc hl
   0059 23            [ 6]  109     inc hl
   005A 4E            [ 7]  110     ld c,(hl) ; velX
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



   005B 23            [ 6]  111     inc hl
   005C 5E            [ 7]  112     ld e,(hl) ; vely
                            113 
   005D 3E 05         [ 7]  114     ld a, #0x05
   005F                     115     setHLposX:
   005F 2B            [ 6]  116         dec hl
   0060 3D            [ 4]  117         dec a
   0061 20 FC         [12]  118         jr NZ, setHLposX
                            119 
   0063 78            [ 4]  120     ld a,b
   0064 81            [ 4]  121     add a,c
   0065 77            [ 7]  122     ld (hl),a
                            123 
   0066 23            [ 6]  124     inc hl
                            125     
   0067 7A            [ 4]  126     ld a,d
   0068 83            [ 4]  127     add a,e
   0069 77            [ 7]  128     ld (hl),a
                            129     
   006A C9            [10]  130    ret
